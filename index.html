<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Graduation Pickup Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root {
      --bg-main: #05060c;
      --bg-card: #11121a;
      --bg-card-soft: #161722;
      --gold: #c9a25f;
      --gold-soft: #e0c58a;
      --gold-deep: #8b6a35;
      --teal: #66c2c2;
      --text-main: #f6f6f6;
      --text-muted: #b2b2b8;
      --danger: #ffcc66;
      --input-bg: #15151c;
      --border-soft: #2b2b35;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.9);
      --radius-lg: 22px;
      --radius-md: 16px;
      --radius-pill: 999px;
      --transition-soft: 0.35s ease;
      --transition-spring: 0.45s cubic-bezier(0.22, 1, 0.36, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 18px 12px 60px;
      overflow-x: hidden;
      position: relative;
      background: radial-gradient(circle at top, #191b27 0, #05060c 55%, #000 100%);
      color: var(--text-main);
    }

    body::before {
      content: "";
      position: fixed;
      inset: -40px;
      pointer-events: none;
      background:
        radial-gradient(circle at top center, rgba(255,255,255,0.03), transparent 55%),
        radial-gradient(circle at bottom, rgba(0,0,0,0.8), transparent 55%);
      z-index: 0;
    }

    a { color: inherit; text-decoration: none; }
    button { font-family: inherit; }

    .orb {
      position: fixed;
      width: 220px;
      height: 220px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(201, 162, 95, 0.4), rgba(10, 14, 18, 0.2));
      filter: blur(4px);
      top: 8%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0.1;
      pointer-events: none;
      animation: orbFloat 12s ease-in-out infinite;
      z-index: 0;
    }

    .orb.orb-boost {
      animation: orbBoost 0.9s ease-out;
    }

    @keyframes orbFloat {
      0%   { transform: translate(-50%, -4px) scale(1); }
      50%  { transform: translate(-51%, 6px) scale(1.03); }
      100% { transform: translate(-50%, -4px) scale(1); }
    }

    @keyframes orbBoost {
      0%   { transform: translate(-50%, 0) scale(1); opacity: 0.18; }
      40%  { transform: translate(-50%, -8px) scale(1.12); opacity: 0.22; }
      100% { transform: translate(-50%, -4px) scale(1); opacity: 0.1; }
    }

    .app-shell {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      text-align: center;
      margin-top: 20px;
      margin-bottom: 16px;
      transition: transform 0.35s ease-out, opacity 0.35s ease-out;
    }

    .logo-wrapper {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 5px;
      border-radius: 18px;
      border: 1px solid rgba(201, 162, 95, 0.35);
      background: radial-gradient(circle at top, rgba(255,255,255,0.06), transparent 60%),
                  linear-gradient(145deg, #101118, #07080f);
      box-shadow:
        0 14px 30px rgba(0,0,0,0.9),
        inset 0 0 0 1px rgba(0,0,0,0.7);
      margin-bottom: 10px;
    }

    .logo-wrapper img {
      width: 68px;
      height: 68px;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.9);
    }

    .header-title {
      font-size: 1.35rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-weight: 600;
      color: var(--gold-soft);
    }

    /* Main card */
    .card {
      background: radial-gradient(circle at top left, #22232f 0, #10111a 45%, #080912 100%);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 16px 16px 18px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      position: relative;
      overflow: hidden;
      transition: transform 0.35s ease-out;
    }

    .card-main { margin-bottom: 14px; }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: radial-gradient(circle at top, rgba(201, 162, 95, 0.16), transparent 60%);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.6s ease-out;
    }

    .card-glow::before {
      opacity: 1;
      animation: cardGlowPulse 1.2s ease-out forwards;
    }

    @keyframes cardGlowPulse {
      0% { opacity: 0; }
      30% { opacity: 1; }
      100% { opacity: 0; }
    }

    .section-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .input-row input {
      flex: 1;
      padding: 10px 14px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-soft);
      background: var(--input-bg);
      color: var(--text-main);
      font-size: 0.96rem;
      outline: none;
      transition: border-color var(--transition-soft), box-shadow var(--transition-soft), background var(--transition-soft);
    }

    .input-row input::placeholder { color: #6b6b73; }

    .input-row input:focus {
      border-color: var(--gold-soft);
      box-shadow: 0 0 0 1px rgba(201, 162, 95, 0.6), 0 0 18px rgba(201, 162, 95, 0.32);
      background: #181822;
    }

    .primary-btn {
      padding: 0 16px;
      border-radius: var(--radius-pill);
      border: none;
      background: linear-gradient(135deg, #c9a25f, #8b6a35);
      color: #0b0b10;
      font-weight: 600;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      white-space: nowrap;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
      transition: transform 0.18s ease-out, box-shadow 0.18s ease-out, filter 0.18s ease-out;
    }

    .primary-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.8);
      filter: brightness(0.96);
    }

    .hint-text {
      font-size: 0.74rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .error-text {
      font-size: 0.78rem;
      color: #ff9b6a;
      min-height: 16px;
      margin-top: 2px;
    }

    /* Results */
    .results-wrapper {
      margin-top: 10px;
      display: none;
      transition: transform 0.35s ease-out, opacity 0.35s.ease-out;
    }

    .results-title {
      font-size: 0.9rem;
      margin-bottom: 8px;
      color: var(--text-muted);
    }

    .result-card {
      background: radial-gradient(circle at top left, #22232f 0, #11111a 40%, #080912 100%);
      border-radius: var(--radius-lg);
      padding: 14px 14px 16px;
      border: 1px solid rgba(255, 255, 255, 0.04);
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
    }

    .result-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .result-title { font-size: 0.98rem; font-weight: 600; }
    .result-sub { font-size: 0.78rem; color: var(--text-muted); }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .info-box {
      border-radius: var(--radius-md);
      background: linear-gradient(145deg, #171822, #0f1018);
      box-shadow:
        0 12px 26px rgba(0, 0, 0, 0.9),
        inset 0 0 0 1px rgba(255, 255, 255, 0.03);
      padding: 8px 10px;
    }

    .info-label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    .info-value {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--gold-soft);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .info-value-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 25%, #f3d9a0, #b4873f 48%, #6c4b1f 100%);
      box-shadow:
        0 10px 20px rgba(0,0,0,0.8),
        inset 0 0 10px rgba(255,255,255,0.18);
      color: #1b1207;
      font-weight: 700;
      font-size: 0.86rem;
      transform: scale(0);
      opacity: 0;
    }

    .info-value-badge.pop-in {
      animation: badgePop 0.5s var(--transition-spring) forwards;
    }

    @keyframes badgePop {
      0% { transform: scale(0.2) translateY(8px); opacity: 0; }
      60% { transform: scale(1.1) translateY(-2px); opacity: 1; }
      100% { transform: scale(1) translateY(0); opacity: 1; }
    }

    .warning-bar {
  display: flex;
  align-items: flex-start; /* ÿ®ÿØŸÑ center ŸÑŸà ÿ™ÿ®ÿ∫Ÿâ ÿßŸÑÿ£ÿ≥ÿ∑ÿ± ÿ™ÿ®ÿØÿ£ ŸÖŸÜ ŸÅŸàŸÇ */
  gap: 6px;
  margin-top: 8px;
  padding: 6px 8px;
  border-radius: var(--radius-md);
  background: linear-gradient(120deg, rgba(255, 204, 102, 0.15), rgba(139, 106, 53, 0.05));
  border: 1px solid rgba(255, 204, 102, 0.35);
  font-size: 0.78rem;
  color: var(--danger);
}


    .warning-icon { font-size: 0.9rem; }

    /* stadium preview inside jacket card */
    .stadium-preview {
      margin-top: 8px;
      border-radius: 14px;
      overflow: hidden;
      background: #05060c;
      border: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,0.7);
      text-align: center;
      padding: 6px 0 2px;
    }

    .stadium-preview img {
      width: 55%;
      max-width: 190px;
      display: block;
      margin: 0 auto 4px;
      border-radius: 12px;
      transform-origin: center center;
      transition: transform 0.25s ease-out;
    }

    .stadium-preview-caption {
      padding: 0 10px 7px;
      font-size: 0.78rem;
      color: var(--text-muted);
      text-align: center;
    }

    .jacket-location-btn {
      width: 100%;
      margin-top: 8px;
      padding: 9px 12px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(102, 194, 194, 0.22);
      background: linear-gradient(135deg, #0b181b, #081214);
      color: var(--teal);
      font-size: 0.84rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      transition: background var(--transition-soft), transform 0.14s ease-out, box-shadow 0.18s ease-out;
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.7);
    }

    .jacket-location-btn:active {
      transform: translateY(1px) scale(0.985);
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.8);
    }

    .robe-block-title { font-size: 0.95rem; font-weight: 600; margin-bottom: 4px; }
    .robe-block-text {
      direction: rtl;
      font-size: 0.82rem;
      color: var(--text-muted);
      line-height: 1.6;
      margin-bottom: 8px;
    }

    .robe-location-btn {
      width: 100%;
      padding: 9px 12px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(201, 162, 95, 0.4);
      background: linear-gradient(135deg, #151521, #1c1c2a);
      color: var(--gold-soft);
      font-size: 0.84rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.8);
      transition: transform 0.14s ease-out, box-shadow 0.14s ease-out, background var(--transition-soft);
    }

    .robe-location-btn:active {
      transform: translateY(1px) scale(0.985);
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.85);
    }

    .no-items {
      font-size: 0.84rem;
      color: var(--text-muted);
      padding: 10px 10px 6px;
    }

    .footer {
      margin-top: 18px;
      text-align: center;
      font-size: 0.68rem;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      color: var(--gold-soft);
      position: relative;
    }

    .footer-glow {
      display: inline-block;
      position: relative;
      padding: 3px 10px;
      border-radius: var(--radius-pill);
      background: rgba(0, 0, 0, 0.22);
      overflow: hidden;
    }

    .footer-glow span {
      background: linear-gradient(120deg, #5b4420, #f1d08d, #5b4420);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: footerGlow 4s linear infinite;
    }

    @keyframes footerGlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.68);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
    }

    .modal-backdrop.active { display: flex; }

    .modal-dialog {
      width: 100%;
      max-width: 420px;
      margin: 0 18px;
      background: radial-gradient(circle at top, #262633 0, #14141b 45%, #09090d 100%);
      border-radius: 22px;
      padding: 16px 16px 14px;
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.04);
      transform: translateY(30px);
      opacity: 0;
      transition: transform var(--transition-spring), opacity var(--transition-soft);
    }

    .modal-backdrop.active .modal-dialog {
      transform: translateY(0);
      opacity: 1;
    }

    .modal-icon {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #f4dea6, #a57c3b);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
      color: #1f130a;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.8);
    }

    .modal-title { font-size: 1rem; font-weight: 600; margin-bottom: 2px; }
    .modal-subtitle { font-size: 0.82rem; color: var(--text-muted); margin-bottom: 8px; }

    .modal-steps {
      margin-bottom: 8px;
      max-height: 48vh;
      overflow-y: auto;
      padding-right: 2px;
    }

    .modal-step { margin-bottom: 6px; }
    .modal-step-title {
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--gold-soft);
      margin-bottom: 1px;
    }
    .modal-step-text {
      font-size: 0.78rem;
      color: var(--text-muted);
      line-height: 1.45;
    }

    .modal-confirm-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 6px;
    }

    .modal-checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.78rem;
      color: var(--text-muted);
      flex: 1;
    }

    .modal-checkbox-row input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--gold-soft);
    }

    .modal-confirm-btn {
      border-radius: var(--radius-pill);
      border: none;
      padding: 7px 12px;
      font-size: 0.82rem;
      font-weight: 600;
      background: linear-gradient(135deg, #c9a25f, #8b6a35);
      color: #121219;
      cursor: pointer;
      white-space: nowrap;
      opacity: 0.4;
      pointer-events: none;
      transition: opacity 0.2s ease-out, transform 0.14s ease-out, box-shadow 0.18s ease-out;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.85);
    }

    .modal-confirm-btn.enabled {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-confirm-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.9);
    }

    /* Stadium popup */
    .stadium-popup {
      position: fixed;
      bottom: -70%;
      left: 0;
      width: 100%;
      height: 65%;
      background: #0c0d13;
      border-top-left-radius: 26px;
      border-top-right-radius: 26px;
      box-shadow: 0 -12px 40px rgba(0, 0, 0, 0.7);
      transition: transform 0.35s cubic-bezier(0.22,1,0.36,1);
      transform: translateY(100%);
      z-index: 2500;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 12px;
      touch-action: none;
    }

    .stadium-popup.active { transform: translateY(0); }

    .stadium-grabber {
      width: 55px;
      height: 6px;
      background: #444;
      border-radius: 6px;
      margin-bottom: 10px;
    }

    .stadium-popup img {
      width: 90%;
      border-radius: 16px;
      transition: transform 0.35s cubic-bezier(0.22,1,0.36,1);
      user-select: none;
      pointer-events: none;
      transform: scale(0.85);
    }

    .stadium-popup.active img {
      transform: scale(1.05);
    }

    @media (max-width: 360px) {
      .header-title { font-size: 1.25rem; }
      .card, .result-card { padding: 12px 12px 14px; }
    }
  </style>
</head>
<body>
  <div class="orb" id="orb"></div>

  <div class="app-shell">
    <header class="header" id="header">
      <div class="logo-wrapper">
        <img src="logo.png" alt="Graduation Logo" />
      </div>
      <div class="header-title">GRADUATION TEAM</div>
    </header>

    <main class="card card-main" id="mainCard">
      <div class="section-label">Student ID lookup</div>

      <form id="lookupForm" autocomplete="off">
        <div class="input-row">
          <input
            id="studentIdInput"
            type="tel"
            inputmode="numeric"
            maxlength="8"
            placeholder="e.g. 20201234"
          />
          <button type="submit" class="primary-btn">
            <span>Check</span>
          </button>
        </div>
        <div class="hint-text">
          Enter your 8-digit student ID to see your jacket and robe pickup details.
        </div>
        <div id="errorText" class="error-text"></div>
      </form>
    </main>

    <section class="results-wrapper" id="resultsSection">
      <div class="results-title">Your graduation items</div>

      <!-- Jacket card -->
      <div class="result-card" id="jacketCard" style="display:none;">
        <div class="result-card-header">
          <div>
            <div class="result-title">Jacket Pickup</div>
            <div class="result-sub" id="stationLabel">Station ‚Äì</div>
          </div>
        </div>

        <div class="info-grid">
          <div class="info-box">
            <div class="info-label">Station</div>
            <div class="info-value">
              <span class="info-value-badge" id="stationBadge">A</span>
            </div>
          </div>
          <div class="info-box">
            <div class="info-label">Pickup period</div>
            <div class="info-value" id="periodMain">Assigned period</div>
          </div>
        </div>

<div class="warning-bar">
  <span class="warning-icon">‚ö†Ô∏è</span>
  <span>
    Important: your items can only be collected at your assigned period.<br />
    Take a <strong>SCREENSHOT</strong> for the organizers at the entrance, and keep your <strong>ID</strong> ready.<br />
    No need for the order number.
  </span>
</div>


        <!-- stadium preview -->
        <div class="stadium-preview" id="stadiumPreview">
          <img src="stadium_layout.jpg" alt="Stadium layout" />
          <div class="stadium-preview-caption"></div>
        </div>

        <!-- Jacket location button -->
        <a
          href="https://maps.app.goo.gl/adK8qC9BRnMzKmiF6?g_st=ipc"
          target="_blank"
          class="jacket-location-btn"
        >
          <span>üìç</span>
          <span>Open sports field location for jacket pickup</span>
        </a>
      </div>

      <!-- Robe card -->
      <div class="result-card" id="robeCard" style="display:none;">
        <div class="robe-block-title">Robe Pickup</div>
        <p class="robe-block-text">
          ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ Ÿäÿ™ŸÖ ŸÖŸÜ ŸÇÿßÿπÿ© ÿßŸÑÿßŸÜÿ¥ÿ∑ÿ© - ÿ±ÿπÿßŸäÿ© ÿßŸÑÿ¥ÿ®ÿßÿ® ŸÅŸä ÿßŸÑŸÉŸÑŸäÿ©. ŸÖŸàÿπÿØ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ : ÿ®ÿπÿØ ÿßÿ≥ÿ™ŸÑÿßŸÖŸÉ ŸÑŸÑÿ¨ÿßŸÉÿ™ ÿ®ÿ±ÿ®ÿπ ÿßŸÑÿ≥ÿßÿπÿ© ÿå Ÿàÿ®ÿπÿØ ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿßŸÑÿ±Ÿàÿ® ŸäŸèŸÅÿ∂ŸëŸÑ ÿßŸÑÿ™Ÿàÿ¨ŸëŸá
          ÿ•ŸÑŸâ ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÉŸÑŸäÿ© ŸÑÿ™ÿÆŸÅŸäŸÅ ÿßŸÑÿ≤ÿ≠ÿßŸÖ ÿπŸÜÿØ ŸÜŸÇÿ∑ÿ© ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ.
        </p>
        <a
          href="https://maps.app.goo.gl/aLQH48X5iewSXqzT8?g_st=ipc"
          target="_blank"
          class="robe-location-btn"
        >
          <span>üìç</span>
          <span>ŸÖŸàŸÇÿπ ŸÇÿßÿπÿ© ÿßŸÑÿßŸÜÿ¥ÿ∑ÿ© - ÿ±ÿπÿßŸäÿ© ÿßŸÑÿ¥ÿ®ÿßÿ®</span>
        </a>
      </div>

      <!-- No items -->
      <div class="result-card" id="noItemsCard" style="display:none;">
        <div class="no-items" id="noItemsText">
          This student ID does not have any graduation items registered.
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="footer-glow">
        <span>PROGRAMMED BY ALBARA</span>
      </div>
    </footer>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="rulesModal">
    <div class="modal-dialog">
      <div class="modal-icon">!</div>
      <div class="modal-title">Before you come to collect</div>
      <div class="modal-subtitle">Please follow these rules.</div>

      <div class="modal-steps">
        <div class="modal-step">
          <div class="modal-step-title">1</div>
          <div class="modal-step-text">
            Bringing your student ID card is mandatory. Knowing your order number helps speed things up, but it‚Äôs okay if you don‚Äôt know it as long as you have your ID ready at pickup.
          </div>
        </div>

        <div class="modal-step">
          <div class="modal-step-title">2</div>
          <div class="modal-step-text">
            If you are unable to come yourself, you may send someone on your behalf. They must have:
            <br />‚Ä¢ A clear photo of your student ID card
            <br />‚Ä¢ Your order number
            <br /><strong>Both are required.</strong>
          </div>
        </div>

        <div class="modal-step">
          <div class="modal-step-title">3</div>
          <div class="modal-step-text">
            Come only at your assigned period. If you miss the pickup day, the next chance will be only after practical exams.
          </div>
        </div>

        <div class="modal-step">
          <div class="modal-step-title">4</div>
          <div class="modal-step-text">
            After collecting your items, move to the college yard to keep the pickup point uncrowded.
          </div>
        </div>
      </div>

      <div class="modal-confirm-row">
        <label class="modal-checkbox-row">
          <input type="checkbox" id="rulesCheckbox" />
          <span>I have read and understood these rules.</span>
        </label>
        <button class="modal-confirm-btn" id="rulesConfirmBtn">Continue</button>
      </div>
    </div>
  </div>

  <!-- Bottom-sheet stadium -->
  <div id="stadium-popup" class="stadium-popup">
    <div class="stadium-grabber"></div>
    <img id="stadium-img" src="stadium_layout.jpg" alt="Stadium Layout" />
  </div>

  <script>
    // Excel columns
    const JACKET_ID_COL = "Student ID ( 8 digits e.g.20200456)";
    const JACKET_STATION_COL = "Station";
    const JACKET_PERIOD_COL = "Period";
    const ROBE_ID_COL = "Student ID";

    const jacketMap = new Map();
    const robeSet = new Set();
    let dataReady = false;

    function normalizeId(value) {
      if (value === undefined || value === null) return "";
      const digits = String(value).replace(/\D/g, "");
      if (!digits) return "";
      return digits.padStart(8, "0");
    }

    function getTrimmed(row, targetName) {
      const target = targetName.trim().toLowerCase();
      for (const key of Object.keys(row)) {
        if (key.trim().toLowerCase() === target) {
          return row[key];
        }
      }
      return "";
    }

    async function loadWorkbook(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error("Failed to load " + url);
      const arrayBuffer = await res.arrayBuffer();
      const workbook = XLSX.read(arrayBuffer, { type: "array" });
      const firstSheetName = workbook.SheetNames[0];
      const sheet = workbook.Sheets[firstSheetName];
      return XLSX.utils.sheet_to_json(sheet, { defval: "" });
    }

    async function loadData() {
      try {
        const [jacketRows, robeRows] = await Promise.all([
          loadWorkbook("Order_Arrangement_UPDATED.xlsx"),
          loadWorkbook("All_graduation_Orders_sorted_by_size.xlsx"),
        ]);

        jacketRows.forEach((row) => {
          const id = normalizeId(getTrimmed(row, JACKET_ID_COL));
          if (!id) return;
          const station = getTrimmed(row, JACKET_STATION_COL);
          const period = getTrimmed(row, JACKET_PERIOD_COL);
          jacketMap.set(id, { station, period });
        });

        robeRows.forEach((row) => {
          const id = normalizeId(getTrimmed(row, ROBE_ID_COL));
          if (!id) return;
          robeSet.add(id);
        });

        dataReady = true;
      } catch (err) {
        console.error("Error loading data:", err);
      }
    }

    window.addEventListener("load", loadData);

    // DOM refs
    const lookupForm = document.getElementById("lookupForm");
    const studentIdInput = document.getElementById("studentIdInput");
    const errorText = document.getElementById("errorText");
    const resultsSection = document.getElementById("resultsSection");
    const jacketCard = document.getElementById("jacketCard");
    const robeCard = document.getElementById("robeCard");
    const noItemsCard = document.getElementById("noItemsCard");
    const noItemsText = document.getElementById("noItemsText");
    const stationBadge = document.getElementById("stationBadge");
    const stationLabelEl = document.getElementById("stationLabel");
    const periodMainEl = document.getElementById("periodMain");
    const mainCard = document.getElementById("mainCard");
    const header = document.getElementById("header");
    const orb = document.getElementById("orb");
    const rulesModal = document.getElementById("rulesModal");
    const rulesCheckbox = document.getElementById("rulesCheckbox");
    const rulesConfirmBtn = document.getElementById("rulesConfirmBtn");
    const stadiumPopup = document.getElementById("stadium-popup");
    const stadiumImg = document.getElementById("stadium-img");
    const stadiumPreview = document.getElementById("stadiumPreview");
    const stadiumPreviewImg = stadiumPreview ? stadiumPreview.querySelector("img") : null;

    let pendingLookup = null;
    let lastLookupHasJacket = false;

    // digits only in input
    studentIdInput.addEventListener("input", () => {
      studentIdInput.value = studentIdInput.value.replace(/[^0-9]/g, "").slice(0, 8);
    });

    // Modal
    function openRulesModal() {
      rulesCheckbox.checked = false;
      rulesConfirmBtn.classList.remove("enabled");
      rulesModal.classList.add("active");
    }

    function closeRulesModal() {
      rulesModal.classList.remove("active");
    }

    rulesCheckbox.addEventListener("change", () => {
      if (rulesCheckbox.checked) {
        rulesConfirmBtn.classList.add("enabled");
      } else {
        rulesConfirmBtn.classList.remove("enabled");
      }
    });

    rulesConfirmBtn.addEventListener("click", () => {
      if (!rulesCheckbox.checked || !pendingLookup) return;

      closeRulesModal();
      applyResults(pendingLookup.id, pendingLookup.hasJacket, pendingLookup.hasRobe);
      if (lastLookupHasJacket) {
        openStadiumPopup();
      }
      pendingLookup = null;
    });

    // Stadium popup drag
    let startY = 0;
    let currentY = 0;
    let dragging = false;

    function onDragStart(clientY) {
      dragging = true;
      startY = clientY;
      currentY = 0;
    }

    function onDragMove(clientY) {
      if (!dragging) return;
      currentY = clientY - startY;
      if (currentY > 0) {
        const translate = currentY;
        stadiumPopup.style.transform = "translateY(" + translate + "px)";
      }
    }

    function onDragEnd() {
      if (!dragging) return;
      dragging = false;

      if (currentY > 140) {
        stadiumPopup.classList.remove("active");
        stadiumPopup.style.transform = "translateY(100%)";
      } else {
        stadiumPopup.classList.add("active");
        stadiumPopup.style.transform = "translateY(0)";
      }
      currentY = 0;
    }

    stadiumPopup.addEventListener("touchstart", (e) => {
      const t = e.touches[0];
      onDragStart(t.clientY);
    });
    stadiumPopup.addEventListener("touchmove", (e) => {
      const t = e.touches[0];
      onDragMove(t.clientY);
    });
    stadiumPopup.addEventListener("touchend", () => onDragEnd());

    stadiumPopup.addEventListener("mousedown", (e) => onDragStart(e.clientY));
    window.addEventListener("mousemove", (e) => { if (dragging) onDragMove(e.clientY); });
    window.addEventListener("mouseup", () => { if (dragging) onDragEnd(); });

    function openStadiumPopup() {
      stadiumPopup.classList.add("active");
      stadiumPopup.style.transform = "translateY(0)";
    }

    // Click on preview to open popup (always)
    if (stadiumPreview) {
      stadiumPreview.addEventListener("click", () => {
        openStadiumPopup();
      });
    }

    // Scroll swap animation + stadium preview scale on scroll
    window.addEventListener("scroll", () => {
      const y = window.scrollY;
      const max = 180;
      const t = Math.min(y / max, 1);

      const mainScale = 1 - 0.04 * t;
      const mainTranslate = -4 * t;
      mainCard.style.transform = `translateY(${mainTranslate}px) scale(${mainScale})`;

      const headerTranslate = -6 * t;
      const headerOpacity = 1 - 0.3 * t;
      header.style.transform = `translateY(${headerTranslate}px)`;
      header.style.opacity = headerOpacity.toString();

      const resultsTranslate = 12 * (1 - t);
      const resultsOpacity = 0.1 + 0.9 * t;
      resultsSection.style.transform = `translateY(${resultsTranslate}px)`;
      resultsSection.style.opacity = resultsOpacity.toString();

      if (stadiumPreviewImg) {
        const imgScale = 1 + 0.06 * t; // ŸäŸÉÿ®ÿ± ÿ¥ŸàŸä ŸÖÿπ ÿßŸÑÿ≥ŸÉÿ±ŸàŸàŸÑ
        stadiumPreviewImg.style.transform = `scale(${imgScale})`;
      }
    });

    // Animations & results
    function boostOrb() {
      orb.classList.remove("orb-boost");
      void orb.offsetWidth;
      orb.classList.add("orb-boost");
    }

    function animateMainCard() {
      mainCard.classList.remove("card-glow");
      void mainCard.offsetWidth;
      mainCard.classList.add("card-glow");
    }

    function showResultsWrapper() {
      resultsSection.style.display = "block";
      resultsSection.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function applyResults(id, hasJacket, hasRobe) {
      jacketCard.style.display = "none";
      robeCard.style.display = "none";
      noItemsCard.style.display = "none";

      if (hasJacket) {
        const data = jacketMap.get(id);
        const station = data && data.station ? String(data.station).trim() : "";
        const period = data && data.period ? String(data.period).trim() : "";

        const stationLetter = station ? station.toString().trim().charAt(0).toUpperCase() : "-";
        stationBadge.textContent = stationLetter || "-";

        stationLabelEl.textContent = station ? ("Station " + station) : "Station ‚Äì";
        periodMainEl.textContent = period || "Assigned period";

        stationBadge.classList.remove("pop-in");
        void stationBadge.offsetWidth;
        stationBadge.classList.add("pop-in");

        jacketCard.style.display = "block";
      }

      if (hasRobe) {
        robeCard.style.display = "block";
      }

      if (!hasJacket && !hasRobe) {
        noItemsText.textContent = "This student ID does not have any graduation items registered.";
        noItemsCard.style.display = "block";
      }

      animateMainCard();
      boostOrb();
      showResultsWrapper();
    }

    // Lookup submit
    lookupForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const rawId = studentIdInput.value.trim();
      const normalized = normalizeId(rawId);
      errorText.textContent = "";

      if (!normalized || normalized.length < 6) {
        errorText.textContent = "Please enter a valid student ID.";
        return;
      }

      if (!dataReady) {
        errorText.textContent = "Data is still loading. Please try again in a few seconds.";
        return;
      }

      const hasJacket = jacketMap.has(normalized);
      const hasRobe = robeSet.has(normalized);

      lastLookupHasJacket = hasJacket;

      if (!hasJacket && !hasRobe) {
        pendingLookup = null;
        applyResults(normalized, false, false);
        return;
      }

      pendingLookup = { id: normalized, hasJacket, hasRobe };
      openRulesModal();
    });
  </script>
</body>
</html>
